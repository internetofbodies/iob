<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Tracker</title>

    <!--Favicon-->
    <link rel="icon" href="logo.png" type="image/png">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <!-- Linking external CSS -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" /> <!-- Leaflet CSS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js -->
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script> <!-- Leaflet JS -->

</head>
<body>
    <!-- Add a label describing the checkbox -->
    <input type="checkbox" id="check" aria-label="Toggle mobile menu">
    
    <!-- Navbar --> 
    <nav class="navbar">
      <div class="navbar__container">
        <a href="#" id="navbar__logo">
          <img src="logo.png" alt="Logo" class="logo-image">
        </a>
        <ul class="navbar__menu">
          <li class="navbar__item"><a href="front.html" class="navbar__links">Health Dashboard</a></li>
          <li class="navbar__btn"><a href="index.html" class="button">Logout</a></li>
        </ul>
        
        <!-- Mobile Menu Icon -->
        <label for="check" class="mobile-menu-icon">
          <i class="fas fa-bars menu-btn"></i>
          <i class="fas fa-times close-btn"></i>
        </label>
      </div>
    </nav>

      <h1 class="dashboard-title">City Disease Tracker</h1>

      <main>
          <!-- Map Section -->
          <section id="map-section" class="feature-section">
              <h3>City Baron Diseases Cases</h3>
              <p>View famous cities in the USA and monitor disease cases such as COVID-19 and bird flu.</p>
              <div id="map"></div>
          </section>

        <!-- Chatbot Section -->
        <section id="chatbot-section" class="feature-section">
            <h3>Ask the Chatbot</h3>
            <p>Ask predefined questions about COVID-19 infections in cities.</p>
            
            <div class="chatbot-container">
                <label for="question">Ask a question:</label>
                <input type="text" id="question" placeholder="Type a question..." value="">
                <button onclick="getChatbotResponse()">Ask</button>
                <div id="chatbot-response" class="chatbot-response"></div>
            </div>
        </section>

        <!-- City Data Section -->
        <section id="city-data" class="feature-section">
            <h3>City Disease Statistics</h3>
            <!-- Checkbox to toggle city statistics -->
            <div class="checkbox-container">
                <input type="checkbox" id="toggle-city-data">
                <label for="toggle-city-data">Show City Statistics</label>
            </div>

            <div id="city-content" style="display: none;">
                <p>Monitor the spread of diseases in real-time across famous cities in the USA.</p>
                <div id="city-list">
                    <p>New York: COVID-19 Cases: <span id="nyc-covid">Loading...</span></p>
                    <p>New York: Bird Flu Cases: <span id="nyc-birdflu">Loading...</span></p>
                    <p>Los Angeles: COVID-19 Cases: <span id="la-covid">Loading...</span></p>
                    <p>Los Angeles: Bird Flu Cases: <span id="la-birdflu">Loading...</span></p>
                    <p>Chicago: COVID-19 Cases: <span id="chicago-covid">Loading...</span></p>
                    <p>Chicago: Bird Flu Cases: <span id="chicago-birdflu">Loading...</span></p>
                </div>

                <!-- Disease Chart -->
                <canvas id="diseaseChart"></canvas>
            </div>
        </section>
      </main>

      <script>
          // Initialize the map
          var map = L.map('map').setView([37.0902, -95.7129], 4); // Centered in the USA

          // Add OpenStreetMap tiles
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              attribution: 'Â© OpenStreetMap contributors'
          }).addTo(map);

          // Add markers for the famous cities
          var cities = [
              { name: "New York", coords: [40.7128, -74.0060], covidCases: 8419, birdFluCases: 72 },
              { name: "Los Angeles", coords: [34.0522, -118.2437], covidCases: 3980, birdFluCases: 50 },
              { name: "Chicago", coords: [41.8781, -87.6298], covidCases: 2716, birdFluCases: 72 }
          ];

          cities.forEach(city => {
              L.marker(city.coords).addTo(map)
                .bindPopup(`<b>${city.name}</b><br>COVID-19 Cases: <span id="${city.name.toLowerCase().replace(/\s/g, '')}-covid">${city.covidCases}</span><br>Bird Flu Cases: <span id="${city.name.toLowerCase().replace(/\s/g, '')}-birdflu">${city.birdFluCases}</span>`);
          });

          // Function to update city statistics data and the chart
          const updateCityData = () => {
              cities.forEach(city => {
                  const birdFluElement = document.getElementById(`${city.name.toLowerCase().replace(/\s/g, '')}-birdflu`);
                  const covidElement = document.getElementById(`${city.name.toLowerCase().replace(/\s/g, '')}-covid`);

                  // Check if the elements exist before updating
                  if (birdFluElement) {
                      birdFluElement.textContent = city.birdFluCases;
                  }

                  if (covidElement) {
                      covidElement.textContent = city.covidCases;
                  }
              });

              // Update the chart with the new COVID data
              diseaseChart.data.datasets[0].data = cities.map(city => city.covidCases);
              diseaseChart.update();
          };

          // Chart.js for visualizing disease cases
          const ctx = document.getElementById('diseaseChart').getContext('2d');
          const diseaseChart = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: cities.map(city => `${city.name} COVID-19`),
                  datasets: [{
                      label: 'COVID-19 Cases',
                      data: cities.map(city => city.covidCases),
                      backgroundColor: 'rgba(255, 99, 132, 0.2)',
                      borderColor: 'rgba(255, 99, 132, 1)',
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      y: {
                          beginAtZero: true
                      }
                  }
              }
          });

          // Show or hide city statistics based on the checkbox
          const toggleCityCheckbox = document.getElementById("toggle-city-data");
          const cityContent = document.getElementById("city-content");

          // Show city statistics if checkbox is already checked
          if (toggleCityCheckbox.checked) {
              cityContent.style.display = "block";
          }

          // Add event listener to toggle city statistics visibility
          toggleCityCheckbox.addEventListener("change", function () {
              if (toggleCityCheckbox.checked) {
                  cityContent.style.display = "block"; // Show city statistics
              } else {
                  cityContent.style.display = "none"; // Hide city statistics
              }
          });

          // Chatbot Response Function
          function getChatbotResponse() {
              const question = document.getElementById('question').value.toLowerCase();
              const chatbotResponse = document.getElementById('chatbot-response');

              // Predefined questions and answers
              const questions = {
                  "which cities have the most covid infections and other diseases?": () => {
                      let mostInfectedCity = cities.reduce((maxCity, city) => city.covidCases > maxCity.covidCases ? city : maxCity, cities[0]);
                      let mostBirdFluCity = cities.reduce((maxCity, city) => city.birdFluCases > maxCity.birdFluCases ? city : maxCity, cities[0]);
                      return `The city with the most COVID-19 infections is ${mostInfectedCity.name} with ${mostInfectedCity.covidCases} cases. The city with the most Bird Flu infections is ${mostBirdFluCity.name} with ${mostBirdFluCity.birdFluCases} cases.`;
                  },
                  "how many covid cases in new york": () => {
                      const city = cities.find(city => city.name.toLowerCase() === "new york");
                      return `New York has ${city.covidCases} COVID-19 cases.`;
                  },
                  "how many covid cases in los angeles": () => {
                      const city = cities.find(city => city.name.toLowerCase() === "los angeles");
                      return `Los Angeles has ${city.covidCases} COVID-19 cases.`;
                  },
                  "how many covid cases in chicago": () => {
                      const city = cities.find(city => city.name.toLowerCase() === "chicago");
                      return `Chicago has ${city.covidCases} COVID-19 cases.`;
                  }
              };

              // Check if the question is in the predefined list
              if (questions[question]) {
                  chatbotResponse.innerHTML = `<p>${questions[question]()}</p>`;
              } else {
                  chatbotResponse.innerHTML = `<p>Sorry, I can't answer that question. Please try a different one.</p>`;
              }
          }

          // Run updateCityData every 5 seconds to refresh the data
          window.onload = function() {
              updateCityData();
              setInterval(updateCityData, 5000);
          };

      </script>
  </body>
  </html>
